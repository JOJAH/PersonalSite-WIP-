<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Randomised Circles</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body{
            margin: 0;
        }
        svg{
            display: block;
            background-color: black;
        }
        iframe{
            position: fixed;
            width: 50px;
            height: 50px;
            z-index: 2;
            top: 10px;
            left: 10px;
        }
        #menuButtonContainer{
            display: none;
            position: fixed;
            bottom: 10px;
            width: 40px;
            height: 40px;
            left: 50%;
            cursor: pointer;
            transition: bottom 1s;
        }
        .menuButtonBar{
            width: 35px;
            height: 5px;
            background-color: white;
            margin: 6px 0;

        }
        #menu{
            display: flex;
            position: fixed;
            width: 100%;
            height: 0px;
            bottom: 0px;
            background-color: rgba(255, 255, 255, 0.5);
            transition: height 1s;
            overflow: hidden;
        }
        .sliderContainer{
            width: 50%;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        #amount{
            position: absolute;
            right: 0;
            bottom: 50%;
        }
        #speed{
            transform: rotate(-90deg);
            height: 100%;
            
        }
    </style>
</head>
<body>
    <svg></svg>
<script>
    let width = window.innerWidth;
    let height = window.innerHeight;
    const svg = d3.select('svg')
            .attr('width', width)
            .attr('height', height);

    const blobs = svg.selectAll('circle')
                    .data(d3.range(20))
                    .enter()
                    .append('circle')
                    .attr('r', () => Math.random()*100)
                    .attr('cx', () => Math.random()*width)
                    .attr('cy', () => Math.random()*height)
                    .attr('fill',() => '#'+ Math.floor(Math.random()*16777215).toString(16))
                    
                    .on('mousedown touchstart', function(){
                        d3.select(this).classed('paused',true);
                        d3.select(this).raise();
                    })
                    .on('mouseup touchend', function(){
                        d3.select(this).classed('paused',false);
                    })
                    .on('mouseleave', function(){
                        d3.select(this).classed('paused',false);
                    })

    /* updates the svg if window size changes */
    function updateDimensions(){
        width = window.innerWidth;
        height = window.innerHeight;
        svg.attr('width', width)
            .attr('height', height);
    }
    function updateBlobs(){
        blobs.transition()
        .duration(2000)
        .attr('r', function(){
            if(!d3.select(this).classed('paused')){
                return Math.random()*100;
            }else {
                return d3.select(this).attr('r');
            }}) 
        .attr('cx', function(){
            if(!d3.select(this).classed('paused')){
                return Math.random()*width
            }else {
                return d3.select(this).attr('cx');
            }})
        .attr('cy', function(){
            if(!d3.select(this).classed('paused')){
                return Math.random()*height
            }else {
                return d3.select(this).attr('cy');
            }})
        .attr('fill', function(){
            if(!d3.select(this).classed('paused')){
                const r = Math.floor(Math.random() * 256);  
                const g = Math.floor(Math.random() * 256);
                const b = Math.floor(Math.random() * 256);
                return `rgb(${r}, ${g}, ${b})`;
            }else {
                return d3.select(this).attr('fill');  /* used rgb as hex method used initially in blobs creation changes the colours during the transition and at the end */
            }})
        .on('end', updateBlobs)
    }

    function openMenu(){
        const menu = document.getElementById('menu');
        const menuButton = document.getElementById('menuButtonContainer')   
        if(menu.style.height !== '20%'){
            menu.style.height = '20%';
            menuButton.style.bottom = '20%';
        }else{
            menu.style.height = '0px';
            menuButton.style.bottom = '10px';
        }
    }
    /* menu button appearing and disspearing */
    document.addEventListener('mousemove', function(){
        const menuButton = document.getElementById('menuButtonContainer')   
        if (typeof timer !=="undefined"){
            clearTimeout(timer);
        }else{}
            
        menuButton.style.display = "inline";
        timer = setTimeout(()=>{
            menuButton.style.display = "none";
        },2000);
        
    });
    /* window resizing*/
    window.addEventListener('resize', updateDimensions);
    /* initial start the circles moving */
    updateBlobs(); 
</script>

<iframe src="../../assets/backArrow.html" frameborder="0"></iframe>

<div id="menuButtonContainer" onclick="openMenu()">
    <div class="menuButtonBar"></div>
    <div class="menuButtonBar"></div>
    <div class="menuButtonBar"></div>
</div>

<div id="menu">
    <div class="sliderContainer">
        <input type="range" id="amount">
    </div>
    <div  class="sliderContainer">
        <input type="range" id="speed">
    </div>

</div>

</body>
</html>